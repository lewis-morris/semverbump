# semverbump

Keep your project's version numbers honest by inspecting public interfaces and
recommending the next semantic version. It can even apply the bump for you.

## Features

- Static diff of the public API to highlight breaking changes.
- Pluggable analysers for command-line tools, web routes and database
  migrations.
- Optional helpers to update ``pyproject.toml`` and tag the release.

## Installation

```bash
pip install semverbump
```

## Quick start

1. **Create a configuration file** (``semverbump.toml``) to customise behaviour:

   ```toml
   [analyzers]
   cli = true      # enable CLI analysis
   web_routes = false  # disable route analysis
   ```

2. **Suggest the next version** between two git references:

   ```console
   $ semverbump decide --base origin/main --head HEAD --format md
   **semverbump** suggests: `minor`

   - [MINOR] cli.new_command: added CLI entry 'greet'
   ```

   Use ``--format text`` for plain output or ``--format json`` for
   machine-readable results.

3. **Apply the bump** and optionally commit and tag the release:

   ```console
   $ semverbump bump --level minor --pyproject pyproject.toml --commit --tag
   Bumped version: 1.2.3 -> 1.3.0 (minor)
   ```

   Omitting ``--level`` triggers an automatic decision using ``--base`` and
   ``--head`` in the same manner as the ``decide`` command.

## Configuration

Only analysers explicitly set to ``true`` run. See ``docs/configuration.rst`` for
full details. The default file name is ``semverbump.toml`` but you may specify an
alternative with ``--config``.

### Analyser reference

#### CLI (``cli``)

Tracks command-line interfaces defined with ``argparse`` or ``click``.

Severity rules:

- Removed command → **major**
- Added command → **minor**
- Removed required option/argument → **major**
- Removed optional option/argument → **minor**
- Added required option/argument → **major**
- Added optional option/argument → **minor**
- Option/argument became optional → **minor**
- Option/argument became required → **major**

Configuration:

```toml
[analyzers]
cli = true  # enable
# cli = false  # disable
```

Dependencies: analysis of Click applications requires the ``click`` package.

#### Web routes (``web_routes``)

Detects HTTP route changes in Flask or FastAPI applications.

Severity rules:

- Removed route → **major**
- Added route → **minor**
- Removed required parameter → **major**
- Removed optional parameter → **minor**
- Added required parameter → **major**
- Added optional parameter → **minor**
- Parameter became optional → **minor**
- Parameter became required → **major**

Configuration:

```toml
[analyzers]
web_routes = true  # enable
# web_routes = false  # disable
```

Dependencies: requires ``flask`` or ``fastapi``.

#### Migrations

Analyses Alembic migration scripts for schema changes.

Severity rules:

- ``op.drop_column`` → **major**
- ``op.add_column`` (non-nullable without default) → **major**
- ``op.add_column`` (otherwise) → **minor**
- ``op.create_index`` → **minor**

Configuration:

```toml
[migrations]
paths = ["migrations"]  # directories containing Alembic scripts
# paths = []             # disable migration analysis
```

Dependencies: expects migrations generated by ``alembic``.

### Third-party dependencies

Ensure project dependencies for analysers are installed:

- ``click`` for the CLI analyser
- ``flask`` or ``fastapi`` for the web route analyser
- ``alembic`` for the migrations analyser
- Other plugins may require additional libraries such as ``jsonschema``

## Roadmap

Planned enhancements and ideas for future development include:

- **Additional analysers**: support for GraphQL schemas, gRPC services,
  and OpenAPI specifications to broaden coverage of public interfaces.
- **Plugin architecture**: allow projects to register custom analysers and
  severity rules through a stable extension API.
- **Configurable severity**: enable user-defined mapping of changes to
  semantic version levels.
- **Rich reports**: emit machine-readable JSON or human-friendly HTML
  summaries of detected changes.
- **CI integration**: provide streamlined helpers for GitHub Actions and
  other CI systems.
- **Performance improvements**: caching mechanisms and smarter diffing to
  handle large repositories efficiently.

For more background and advanced usage, see the full documentation in the
``docs`` directory.
